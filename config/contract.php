<?php

return [
    /*
    | Сообщение при ошибке загрузки (ТЗ п.7)
    */
    'error_upload_message' => 'Пожалуйста, загрузите договор или выбранные страницы договора.',

    /*
    | Лимит количества фото в одном запросе (ТЗ п.5.2 — первый этап)
    */
    'max_photos_per_request' => 5,

    /*
    | Максимальный размер одного файла (байты). Telegram до 20 MB для бота.
    */
    'max_file_size_bytes' => 20 * 1024 * 1024,

    /*
    | Веб: макс. количество файлов в одной загрузке (ТЗ п.3.2 — 30–40 страниц, по файлам).
    */
    'max_upload_files' => (int) env('CONTRACT_MAX_UPLOAD_FILES', 40),

    /*
    | Срок хранения результатов анализа (месяцы). ТЗ п.9 — по умолчанию 6 месяцев.
    */
    'analysis_retention_months' => 6,

    /*
    | Порог: при длине текста выше этого значения документ разбивается на части, анализируется по частям и результаты объединяются.
    | Ниже порога — один запрос к AI. ~1 токен ≈ 2–4 символа; 35000 символов ≈ 10–17k токенов (укладывается в лимиты TPM).
    */
    'max_document_chars_for_ai' => (int) env('CONTRACT_MAX_DOCUMENT_CHARS_FOR_AI', 35000),

    /*
    | Размер одного фрагмента при разбиении длинного документа (символов).
    */
    'chunk_size' => (int) env('CONTRACT_CHUNK_SIZE', 32000),

    /*
    | Перекрытие между соседними фрагментами (символов), чтобы не терять контекст на стыке.
    */
    'chunk_overlap' => (int) env('CONTRACT_CHUNK_OVERLAP', 2000),

    /*
    | ID модели AI для анализа договоров (таблица ai_models). 0 = первая активная по sort_order.
    */
    'default_ai_model_id' => (int) env('CONTRACT_DEFAULT_AI_MODEL_ID', 0),

    /*
    | Допустимые MIME-типы для загрузки
    */
    'allowed_mime_types' => [
        'application/pdf',
        'application/msword',                                                    // .doc
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // .docx
        'image/jpeg',
        'image/png',
        'application/zip',
    ],

    /*
    | Допустимые расширения (для имени файла)
    */
    'allowed_extensions' => ['pdf', 'doc', 'docx', 'jpg', 'jpeg', 'png', 'zip'],

    /*
    | Ключевое слово в имени файла для приоритета при выборе из ZIP (ТЗ п.4.2)
    */
    'priority_filename_keyword' => 'договор',

    /*
    | OCR: по умолчанию Tesseract-api на том же сервере (порт 8080, путь /ocr, поле file).
    | Чтобы использовать локальный бинарник — задайте TESSERACT_API_URL= в .env (пусто).
    */
    'tesseract_api_url' => env('TESSERACT_API_URL', 'http://127.0.0.1:8080/ocr'),
    'tesseract_api_field' => env('TESSERACT_API_FIELD', 'file'),

    /*
    | Путь к исполняемому файлу Tesseract (используется, если tesseract_api_url пуст).
    */
    'tesseract_path' => env('TESSERACT_PATH', 'tesseract'),

    /*
    | Языки для Tesseract (binary или заголовок X-Language для API).
    */
    'tesseract_lang' => env('TESSERACT_LANG', 'rus+eng'),

    /*
    | Формат выдачи результата в Telegram (ТЗ п.8).
    | full — одно сообщение с полной выжимкой (до telegram_max_message_chars).
    | short — одно сообщение с краткой выжимкой (до telegram_short_summary_chars).
    | both — сначала краткая, затем полная выжимка двумя сообщениями.
    */
    'telegram_summary_mode' => env('CONTRACT_TELEGRAM_SUMMARY_MODE', 'full'),

    /*
    | Максимум символов в одном сообщении Telegram (лимит API 4096).
    */
    'telegram_max_message_chars' => (int) env('CONTRACT_TELEGRAM_MAX_CHARS', 4090),

    /*
    | Длина краткой выжимки (при mode short или first сообщение при mode both).
    */
    'telegram_short_summary_chars' => (int) env('CONTRACT_TELEGRAM_SHORT_CHARS', 600),

    /*
    | Системный промпт для AI при анализе договоров. Редактируется в админке (Настройки анализа).
    | Пустое значение в БД = использование этой строки по умолчанию.
    */
    'ai_system_prompt' => <<<'TEXT'
Ты — помощник по извлечению информации из договоров. Твоя задача: по тексту договора составить структурированную выжимку.

Требования:
- Отвечай только на основе приведённого текста. Не давай юридических оценок, не проверяй соответствие законодательству.
- Выжимка — нумерованный список из 15–20 пунктов.
- Для каждого пункта, по которому в договоре есть информация, укажи краткое содержание. Если в тексте нет данных по пункту — не включай его в список или напиши «Не указано».

Извлекай сведения по следующим темам (если есть в тексте):
1. Предмет договора
2. Цена договора
3. Срок начала оказания услуг
4. Срок окончания оказания услуг
5. Срок предоставления заявки
6. Условия использования спецсчёта
7. Порядок оплаты (аванс, сроки, процедура)
8. Необходимые документы для оплаты
9. Ответственность сторон
10. Размер ответственности
11. Подсудность / порядок разрешения споров
12. Требования к транспорту
13. Требования к квалификации персонала
14. Условия расторжения
15. Специальные разрешения
16. Единичные расценки (если присутствуют)

Формат ответа: строго нумерованный список. Каждый пункт с новой строки. Без вступления и заключения.
TEXT,

    /*
    | Шифровать ли персональные данные в bot_users (first_name, last_name, username). ТЗ п.13.
    | Включите после настройки APP_KEY. Существующие записи останутся в открытом виде до следующего обновления.
    */
    'encrypt_bot_user_pii' => env('CONTRACT_ENCRYPT_BOT_USER_PII', false),

    /*
    | Тексты экранов бота (TZ_UX_MENU_AUTH). Переопределяются в ContractSetting.
    */
    'welcome_text' => "Главное меню.\nВыберите действие:\n• Загрузка — отправьте договор для анализа\n• История — последние результаты\n• Сравнение — скоро\n• Поддержка — контакты",
    'unauthorized_text' => "Доступ к боту ограничен сотрудникам компании.\nВведите одноразовый код доступа или обратитесь к администратору.\n\nЕсли у вас нет кода — откройте «Поддержка».",
    'upload_text' => "Загрузите договор или выбранные страницы договора.\nПоддерживаются: PDF, DOC/DOCX, JPG/PNG (до 5 фото), ZIP.\n\nМожно отправить один файл или архив. После загрузки начнётся анализ.",
    'processing_text' => "Документ получен.\nИзвлекаю текст и выполняю анализ…\n\nОбычно это занимает до 1–2 минут (в зависимости от объёма).",
    'busy_text' => "Идёт обработка документа. Подождите, пожалуйста.\nРезультат появится автоматически после завершения.",
    'error_file_text' => "Файл не подходит.\nЗагрузите договор или выбранные страницы договора в формате PDF/DOC/DOCX/JPG/PNG или ZIP.\nЛимит: до 5 изображений.",
    'info_text' => "Бот помогает быстро получить структурированную выжимку по договору.\nПоддерживаемые форматы: PDF, DOC/DOCX, JPG/PNG, ZIP.\nВажно: бот не выполняет юридическую экспертизу.",
    'compare_stub_text' => "Сравнение договоров будет доступно позже.\nСейчас доступна загрузка и история анализов.",
    'history_empty_text' => "История анализов пуста. Сначала выполните загрузку договора.",
    'history_limit' => 10,

    /*
    | Поддержка (шаблон, плейсхолдеры: {support_name}, {support_tg}, {support_email}, {support_hours})
    */
    'support_name' => 'Поддержка',
    'support_tg' => '',
    'support_email' => '',
    'support_hours' => '',
    'support_text' => "Поддержка:\n{support_name}\nTelegram: {support_tg}\nEmail: {support_email}\nЧасы: {support_hours}\n\nОпишите проблему и приложите файл/скрин, если нужно.",

    /*
    | Можно ли показывать «Информация» и «Поддержка» неавторизованным пользователям.
    */
    'allow_public_info' => true,

    /*
    | Одноразовый код доступа (OTP). Если задан — пользователь может ввести его в боте для авторизации.
    | Пустое = только whitelist через /admin и одобрение в админке.
    */
    'bot_otp_code' => null,
];
